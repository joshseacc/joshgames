<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chelsea & Joshua çš„æ—©å®‰é¬§é˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* æ”¹ç”¨ M PLUS Rounded 1c (é¡ç²‰åœ“é«”) å’Œ Nunito (åœ“æ½¤è‹±æ•¸) */
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;800&family=Nunito:wght@400;700;900&display=swap');

        :root {
            --andy-blue: #87CEEB;
            --woody-yellow: #FFD700;
            --woody-red: #E32636;
            --buzz-green: #9ACD32;
            --buzz-purple: #8A2BE2;
        }

        body {
            /* ä½¿ç”¨ Nunito é¡¯ç¤ºè‹±æ•¸ï¼ŒM PLUS Rounded 1c é¡¯ç¤ºä¸­æ–‡ï¼Œç¢ºä¿åœ“æ½¤æ•ˆæœ */
            font-family: 'Nunito', 'M PLUS Rounded 1c', 'Varela Round', 'Microsoft JhengHei', sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: var(--andy-blue);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
        }

        /* Andy's Room Cloud Wallpaper Effect */
        .cloud-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--andy-blue);
            background-image: 
                radial-gradient(circle 25px at 20% 20%, white 99%, transparent 100%),
                radial-gradient(circle 20px at 23% 18%, white 99%, transparent 100%),
                radial-gradient(circle 20px at 17% 18%, white 99%, transparent 100%),
                radial-gradient(circle 35px at 80% 60%, white 99%, transparent 100%),
                radial-gradient(circle 25px at 83% 58%, white 99%, transparent 100%),
                radial-gradient(circle 25px at 77% 58%, white 99%, transparent 100%);
            background-size: 300px 200px;
            animation: drift 60s linear infinite;
            z-index: -1;
        }

        @keyframes drift {
            from { background-position: 0 0; }
            to { background-position: 300px 100px; }
        }

        /* Main Clock Container */
        .toy-container {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 40px;
            padding: 30px 40px;
            box-shadow: 
                0 10px 25px rgba(0,0,0,0.2),
                inset 0 0 0 8px var(--woody-red), 
                inset 0 0 0 12px white,
                inset 0 0 0 15px var(--woody-yellow);
            text-align: center;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-width: 90%;
            width: 550px;
            position: relative;
            z-index: 10;
        }

        .hk-badge {
            background: var(--buzz-green);
            color: white;
            padding: 6px 18px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 800;
            display: inline-block;
            margin-bottom: 5px;
            box-shadow: 2px 2px 0px rgba(0,0,0,0.1);
            letter-spacing: 1px;
        }

        .time-display {
            font-size: 5.5rem;
            color: #333;
            text-shadow: 3px 3px 0px rgba(0,0,0,0.1);
            line-height: 1;
            margin: 10px 0;
            font-weight: 800;
            font-variant-numeric: tabular-nums;
        }

        .countdown-display {
            font-size: 1.4rem;
            color: var(--woody-red);
            background: #fff;
            padding: 8px 20px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 15px;
            border: 3px dashed var(--woody-yellow);
            font-weight: 800;
        }

        .date-display {
            font-size: 1.4rem;
            color: #666;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .message-box {
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            background: rgba(255,255,255,0.6);
            border-radius: 20px;
            padding: 15px;
            margin-top: 10px;
        }

        .status-text {
            font-size: 1.8rem;
            color: var(--buzz-purple);
            line-height: 1.4;
            transition: all 0.3s ease;
            font-weight: 800;
        }

        /* Surprise Overlay */
        .surprise-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 30;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .surprise-element {
            position: absolute;
            font-size: 8rem;
            opacity: 0;
            transition: all 0.5s ease;
            text-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .surprise-text {
            font-size: 2.5rem;
            color: white;
            background: rgba(0,0,0,0.6);
            padding: 10px 20px;
            border-radius: 20px;
            margin-top: 10px;
            white-space: nowrap;
        }

        /* Specific Animations */
        @keyframes slideUp {
            0% { transform: translateY(100vh); opacity: 1; }
            20% { transform: translateY(200px); opacity: 1; }
            80% { transform: translateY(200px); opacity: 1; }
            100% { transform: translateY(100vh); opacity: 0; }
        }

        @keyframes flyAcross {
            0% { transform: translate(-120vw, 50px) rotate(20deg); opacity: 1; }
            100% { transform: translate(120vw, -100px) rotate(20deg); opacity: 1; }
        }

        @keyframes wobbleRun {
            0% { transform: translateX(-100vw) rotate(-10deg); opacity: 1; }
            25% { transform: translateX(-20vw) rotate(10deg); }
            50% { transform: translateX(20vw) rotate(-10deg); }
            75% { transform: translateX(50vw) rotate(10deg); }
            100% { transform: translateX(120vw) rotate(-10deg); opacity: 1; }
        }

        @keyframes popScale {
            0% { transform: scale(0); opacity: 0; }
            10% { transform: scale(1.2); opacity: 1; }
            20% { transform: scale(1); }
            80% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0); opacity: 0; }
        }

        /* Animations */
        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            80% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        .shaking {
            animation: shake 0.5s;
            animation-iteration-count: infinite;
            border-color: var(--woody-red);
        }

        .gogogo-text {
            font-size: 4rem;
            color: var(--woody-red);
            font-weight: 900;
            text-shadow: 4px 4px 0px var(--woody-yellow);
            animation: bounce 0.8s infinite alternate;
            letter-spacing: 2px;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-20px); }
        }

        /* Canvas for Fireworks */
        #fireworksCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 20;
        }

        /* Character Icons */
        .icon-container {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 20px;
            font-size: 2.2rem;
        }
        
        .toy-icon {
            transition: transform 0.3s;
            cursor: pointer;
            filter: drop-shadow(2px 2px 0px rgba(0,0,0,0.1));
        }
        .toy-icon:hover {
            transform: scale(1.3) rotate(15deg);
        }

        /* Controls for Demo */
        .controls {
            position: absolute;
            bottom: 10px;
            right: 10px;
            opacity: 0.1;
            transition: opacity 0.3s;
            z-index: 50;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: flex-end;
            max-width: 600px;
        }
        .controls:hover {
            opacity: 1;
        }
        
        .btn {
            background: white;
            border: 1px solid #ccc;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 8px;
            font-size: 0.8rem;
            font-family: inherit;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <!-- Clouds Background -->
    <div class="cloud-bg"></div>

    <!-- Fireworks Canvas -->
    <canvas id="fireworksCanvas"></canvas>

    <!-- Surprise Overlay Container -->
    <div id="surpriseContainer" class="surprise-overlay"></div>

    <!-- Main Clock Panel -->
    <div class="toy-container" id="clockPanel">
        <div class="hk-badge"><i class="fas fa-clock"></i> é¦™æ¸¯æ™‚é–“</div>
        
        <div class="time-display" id="clock">00:00:00</div>
        
        <!-- Countdown -->
        <div class="countdown-display" id="countdown">
            <i class="fas fa-hourglass-half"></i> è·é›¢ GOGOGO é‚„æœ‰ --:--:--
        </div>

        <div class="date-display" id="date">è¼‰å…¥ä¸­...</div>

        <div class="message-box" id="messageBox">
            <div class="status-text" id="statusText">è¼‰å…¥ä¸­...</div>
        </div>

        <div class="icon-container">
            <i class="fas fa-hat-cowboy toy-icon" style="color: var(--woody-yellow);" title="Woody"></i>
            <i class="fas fa-rocket toy-icon" style="color: var(--buzz-purple);" title="Buzz"></i>
            <i class="fas fa-star toy-icon" style="color: var(--woody-red);" title="Sheriff"></i>
            <i class="fas fa-utensils toy-icon" style="color: var(--buzz-green);" title="Forky"></i>
        </div>
    </div>

    <!-- Hidden Controls for User Testing -->
    <div class="controls">
        <button class="btn" onclick="resetSim()">é‡ç½®</button>
        <button class="btn" style="background:#ffcccc" onclick="testSurprise('6:30', 'aliens')">6:30 ä¸‰çœ¼æ€ª</button>
        <button class="btn" style="background:#ffcccc" onclick="testSurprise('6:35', 'forky')">6:35 Forky</button>
        <button class="btn" style="background:#ffcccc" onclick="testSurprise('6:38', 'rex')">6:38 Rex</button>
        <button class="btn" style="background:#ffcccc" onclick="testSurprise('6:40', 'army')">6:40 å°å…µ</button>
        <button class="btn" style="background:#ffcccc" onclick="testSurprise('6:42', 'hamm')">6:42 ç«è…¿</button>
        <button class="btn" style="background:#ffcccc" onclick="testSurprise('6:47', 'buzz')">6:47 å·´æ–¯</button>
        <button class="btn" onclick="simulateTime(6, 48)">6:48 GOGOGO</button>
    </div>

    <script>
        // --- è®Šæ•¸èˆ‡è¨­å®š ---
        const clockEl = document.getElementById('clock');
        const countdownEl = document.getElementById('countdown');
        const dateEl = document.getElementById('date');
        const statusTextEl = document.getElementById('statusText');
        const clockPanel = document.getElementById('clockPanel');
        const surpriseContainer = document.getElementById('surpriseContainer');
        const canvas = document.getElementById('fireworksCanvas');
        const ctx = canvas.getContext('2d');

        let simulationMode = false;
        let simHours = 0;
        let simMinutes = 0;
        let simSeconds = 0;
        
        // è¿½è¹¤é©šå–œæ˜¯å¦å·²ç¶“è§¸ç™¼é (é¿å…åŒä¸€åˆ†é˜é‡è¤‡è§¸ç™¼)
        let surprisesTriggered = {}; 

        // --- æ ¸å¿ƒé‚è¼¯ ---
        function updateClock() {
            let now = new Date();
            
            if (simulationMode) {
                now.setHours(simHours);
                now.setMinutes(simMinutes);
                now.setSeconds(simSeconds);
                simSeconds++;
                if(simSeconds >= 60) { simSeconds = 0; simMinutes++; }
                if(simMinutes >= 60) { simMinutes = 0; simHours++; }
            }

            let h = now.getHours();
            let m = now.getMinutes();
            let s = now.getSeconds();
            
            // 1. æ›´æ–°ä¸»æ™‚é˜
            let displayH = h < 10 ? '0' + h : h;
            let displayM = m < 10 ? '0' + m : m;
            let displayS = s < 10 ? '0' + s : s;
            clockEl.innerHTML = `${displayH}:${displayM}<span style="font-size:2rem; margin-left:10px">${displayS}</span>`;
            
            // 2. æ›´æ–°æ—¥æœŸ
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            dateEl.innerText = now.toLocaleDateString('zh-HK', options);

            // 3. æ›´æ–°å€’æ•¸èˆ‡ç‹€æ…‹
            updateCountdown(now);
            updateStatus(h, m, s);
            
            // 4. æª¢æŸ¥é©šå–œæ™‚é–“é» (åªé™æ—©ä¸Š 6 é»)
            if (h === 6) {
                checkSurprise(m, s);
            }
        }

        function updateCountdown(now) {
            let target = new Date(now);
            target.setHours(6, 48, 0, 0);
            if (now > target) target.setDate(target.getDate() + 1);

            let diff = target - now;
            let hours = Math.floor(diff / (1000 * 60 * 60));
            let minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            let seconds = Math.floor((diff % (1000 * 60)) / 1000);

            let displayH = hours < 10 ? "0" + hours : hours;
            let displayM = minutes < 10 ? "0" + minutes : minutes;
            let displayS = seconds < 10 ? "0" + seconds : seconds;

            countdownEl.innerHTML = `<i class="fas fa-hourglass-half"></i> è·é›¢ GOGOGO é‚„æœ‰ ${displayH}:${displayM}:${displayS}`;
        }

        let isAlarmActive = false;
        let isPreAlarmActive = false;

        function updateStatus(h, m, s) {
            const currentTimeInMinutes = h * 60 + m;
            const t615 = 6 * 60 + 15;
            const t630 = 6 * 60 + 30;
            const t645 = 6 * 60 + 45;
            const t648 = 6 * 60 + 48;
            const t650 = 6 * 60 + 50;

            if (currentTimeInMinutes < t615) {
                resetEffects();
                statusTextEl.innerHTML = `<i class="fas fa-bed"></i> Zzz...<br>ç©å…·å€‘åœ¨ç¡è¦º`;
                statusTextEl.style.color = "#888";
            }
            else if (currentTimeInMinutes >= t615 && currentTimeInMinutes < t630) {
                resetEffects();
                statusTextEl.innerHTML = `<i class="fas fa-bath"></i> æ—©å®‰ï¼<br>ç©å…·å€‘åœ¨æ¢³æ´— (åˆ·ç‰™æ´—è‡‰!)`;
                statusTextEl.style.color = "var(--andy-blue)";
            }
            else if (currentTimeInMinutes >= t630 && currentTimeInMinutes < t645) {
                resetEffects();
                statusTextEl.innerHTML = `<i class="fas fa-mug-hot"></i> æ—©é¤æ™‚é–“<br>ç©å…·å€‘åœ¨åƒæ—©é¤ Yummy!`;
                statusTextEl.style.color = "var(--woody-red)";
            }
            else if (currentTimeInMinutes >= t645 && currentTimeInMinutes < t648) {
                if (!isPreAlarmActive) {
                    isPreAlarmActive = true;
                    clockPanel.style.transform = "scale(1.05)";
                    clockPanel.classList.add('shaking');
                    setTimeout(() => clockPanel.classList.remove('shaking'), 3000);
                }
                statusTextEl.innerHTML = `<i class="fas fa-running"></i> èµ·åºŠæ™‚é–“å¿«åˆ°äº†...<br>ç©å…·å€‘æº–å‚™é›†åˆï¼`;
                statusTextEl.style.color = "var(--buzz-purple)";
            }
            else if (currentTimeInMinutes >= t648 && currentTimeInMinutes < t650) {
                if (!isAlarmActive) {
                    isAlarmActive = true;
                    startFireworks();
                    clockPanel.classList.add('shaking');
                    clockPanel.style.background = "rgba(255,255,255,0.95)";
                }
                statusTextEl.innerHTML = `<div class="gogogo-text">GOGOGO!</div>
                                          <div style="font-size: 1.5rem; margin-top: 10px; color: #333;">
                                            æ—©å®‰ Chelsea & Joshua!<br>Have a Good Day!
                                          </div>`;
            }
            else {
                resetEffects();
                statusTextEl.innerHTML = `ç©å…·å€‘å»å†’éšªäº†ï¼<br>æ˜å¤©è¦‹ï¼`;
                statusTextEl.style.color = "#555";
            }
        }

        // --- é©šå–œç‰¹æ•ˆé‚è¼¯ ---
        function checkSurprise(m, s) {
            const timeKey = `6:${m}`;
            
            // é¿å…é‡è¤‡è§¸ç™¼ï¼šå¦‚æœé€™åˆ†é˜å·²ç¶“è§¸ç™¼éï¼Œä¸”ç§’æ•¸å¤§æ–¼ 5ï¼Œå°±ä¸å†è§¸ç™¼
            // (æˆ‘å€‘å…è¨±å‰ 5 ç§’è§¸ç™¼ï¼Œç¢ºä¿å¦‚æœç¶²é å‰›æ‰“é–‹ä¹Ÿèƒ½çœ‹åˆ°)
            if (surprisesTriggered[timeKey] && s > 5) return;

            // å®šç¾©æ™‚é–“é»èˆ‡æ•ˆæœ
            if (m === 30 && !surprisesTriggered[timeKey]) {
                triggerSurpriseEffect('aliens', 'ğŸ‘½ Ooooooh~ The Claw!', 'slideUp');
                surprisesTriggered[timeKey] = true;
            } else if (m === 35 && !surprisesTriggered[timeKey]) {
                triggerSurpriseEffect('forky', 'ğŸ´ æˆ‘ä¸æ˜¯åƒåœ¾ï¼Œæˆ‘æ˜¯ç©å…·ï¼', 'wobbleRun');
                surprisesTriggered[timeKey] = true;
            } else if (m === 38 && !surprisesTriggered[timeKey]) {
                triggerSurpriseEffect('rex', 'ğŸ¦– ROAR! æˆ‘åš‡åˆ°ä½ äº†å—ï¼Ÿ', 'popScale');
                surprisesTriggered[timeKey] = true;
            } else if (m === 40 && !surprisesTriggered[timeKey]) {
                triggerSurpriseEffect('army', 'ğŸª– Go! Go! Go! å¿«åƒæ—©é¤ï¼', 'wobbleRun');
                surprisesTriggered[timeKey] = true;
            } else if (m === 42 && !surprisesTriggered[timeKey]) {
                triggerSurpriseEffect('hamm', 'ğŸ· é‚„æœ‰æ™‚é–“ï¼Œä½†è¦å¿«å›‰ï¼', 'popScale');
                surprisesTriggered[timeKey] = true;
            } else if (m === 47 && !surprisesTriggered[timeKey]) {
                triggerSurpriseEffect('buzz', 'ğŸš€ To Infinity... and Beyond!', 'flyAcross');
                surprisesTriggered[timeKey] = true;
            }
        }

        function triggerSurpriseEffect(type, text, animationName) {
            // æ¸…é™¤èˆŠçš„
            surpriseContainer.innerHTML = '';

            const el = document.createElement('div');
            el.className = 'surprise-element';
            el.style.animation = `${animationName} 6s forwards`; // å‹•ç•«æŒçºŒ 6 ç§’
            
            let iconHtml = '';
            if (type === 'aliens') iconHtml = 'ğŸ‘½ ğŸ‘½ ğŸ‘½';
            if (type === 'forky') iconHtml = '<i class="fas fa-utensils" style="color:#aaa;"></i>';
            if (type === 'rex') iconHtml = '<i class="fas fa-dragon" style="color:var(--buzz-green);"></i>';
            if (type === 'army') iconHtml = '<i class="fas fa-user-secret" style="color:green;"></i> <i class="fas fa-user-secret" style="color:green;"></i>';
            if (type === 'hamm') iconHtml = '<i class="fas fa-piggy-bank" style="color:pink;"></i>';
            if (type === 'buzz') iconHtml = '<i class="fas fa-rocket" style="color:var(--buzz-purple);"></i>';

            el.innerHTML = `
                <div style="font-size: 8rem;">${iconHtml}</div>
                <div class="surprise-text">${text}</div>
            `;

            surpriseContainer.appendChild(el);

            // 6ç§’å¾Œè‡ªå‹•ç§»é™¤ DOM
            setTimeout(() => {
                if (surpriseContainer.contains(el)) {
                    surpriseContainer.removeChild(el);
                }
            }, 6000);
        }

        // --- æ‰‹å‹•æ¸¬è©¦æŒ‰éˆ•åŠŸèƒ½ ---
        function testSurprise(timeStr, type) {
            // é‡ç½®è©²æ™‚é–“é»çš„è§¸ç™¼æ¨™è¨˜ï¼Œè®“æŒ‰éˆ•å¯ä»¥é‡è¤‡é»æ“Š
            let m = parseInt(timeStr.split(':')[1]);
            surprisesTriggered[`6:${m}`] = false;
            
            // é€²å…¥æ¨¡æ“¬æ¨¡å¼
            simulateTime(6, m);
            
            // ç«‹å³è§¸ç™¼
            // æ³¨æ„ï¼šsimulateTime é è¨­ç§’æ•¸æ˜¯ 50ï¼ŒæœƒéŒ¯é checkSurprise çš„ s<=5 æª¢æŸ¥
            // æ‰€ä»¥æ‰‹å‹•å‘¼å«
            let animationName = 'popScale';
            let text = 'æ¸¬è©¦ä¸­...';
            if (type === 'aliens') { animationName = 'slideUp'; text = 'ğŸ‘½ Ooooooh~ The Claw!'; }
            if (type === 'forky') { animationName = 'wobbleRun'; text = 'ğŸ´ æˆ‘ä¸æ˜¯åƒåœ¾ï¼Œæˆ‘æ˜¯ç©å…·ï¼'; }
            if (type === 'rex') { animationName = 'popScale'; text = 'ğŸ¦– ROAR! æˆ‘åš‡åˆ°ä½ äº†å—ï¼Ÿ'; }
            if (type === 'army') { animationName = 'wobbleRun'; text = 'ğŸª– Go! Go! Go! å¿«åƒæ—©é¤ï¼'; }
            if (type === 'hamm') { animationName = 'popScale'; text = 'ğŸ· é‚„æœ‰æ™‚é–“ï¼Œä½†è¦å¿«å›‰ï¼'; }
            if (type === 'buzz') { animationName = 'flyAcross'; text = 'ğŸš€ To Infinity... and Beyond!'; }
            
            triggerSurpriseEffect(type, text, animationName);
        }

        function resetEffects() {
            if (isAlarmActive || isPreAlarmActive) {
                isAlarmActive = false;
                isPreAlarmActive = false;
                stopFireworks();
                clockPanel.classList.remove('shaking');
                clockPanel.style.transform = "scale(1)";
                clockPanel.style.background = "rgba(255, 255, 255, 0.85)";
            }
        }

        // --- ç…™èŠ±ç‰¹æ•ˆ (Canvas) ---
        let fireworks = [];
        let animationId;

        class Firework {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = canvas.height;
                this.sx = Math.random() * 3 - 1.5;
                this.sy = -(Math.random() * 4 + 4);
                this.size = Math.random() * 2 + 1;
                const colors = ['#E32636', '#FFD700', '#9ACD32', '#8A2BE2', '#87CEEB'];
                this.color = colors[Math.floor(Math.random() * colors.length)];
                this.particles = [];
                this.exploded = false;
            }

            update() {
                if (!this.exploded) {
                    this.x += this.sx;
                    this.y += this.sy;
                    this.sy += 0.05;

                    if (this.sy >= -1) {
                        this.exploded = true;
                        for (let i = 0; i < 50; i++) {
                            this.particles.push(new Particle(this.x, this.y, this.color));
                        }
                    }
                } else {
                    for (let i = this.particles.length - 1; i >= 0; i--) {
                        this.particles[i].update();
                        if (this.particles[i].alpha <= 0) {
                            this.particles.splice(i, 1);
                        }
                    }
                }
            }

            draw() {
                if (!this.exploded) {
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                } else {
                    this.particles.forEach(p => p.draw());
                }
            }
        }

        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 3 + 1;
                this.vx = Math.cos(angle) * speed;
                this.vy = Math.sin(angle) * speed;
                this.alpha = 1;
                this.color = color;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.05;
                this.alpha -= 0.02;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }

        function startFireworks() {
            if(animationId) return;
            resizeCanvas();
            animate();
        }

        function stopFireworks() {
            cancelAnimationFrame(animationId);
            animationId = null;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            fireworks = [];
        }

        function animate() {
            ctx.fillStyle = 'rgba(135, 206, 235, 0.2)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (Math.random() < 0.05) {
                fireworks.push(new Firework());
            }

            for (let i = fireworks.length - 1; i >= 0; i--) {
                fireworks[i].update();
                fireworks[i].draw();
                if (fireworks[i].exploded && fireworks[i].particles.length === 0) {
                    fireworks.splice(i, 1);
                }
            }
            animationId = requestAnimationFrame(animate);
        }

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        window.addEventListener('resize', resizeCanvas);

        // --- æ¸¬è©¦æ§åˆ¶ ---
        function simulateTime(h, m) {
            simulationMode = true;
            simHours = h;
            simMinutes = m;
            simSeconds = 0; // æ”¹ç‚º 0 ç§’é–‹å§‹ï¼Œæ–¹ä¾¿è§€å¯Ÿé©šå–œ
            resetEffects();
        }

        function resetSim() {
            simulationMode = false;
            resetEffects();
            surpriseContainer.innerHTML = '';
            surprisesTriggered = {};
        }

        // åˆå§‹åŒ–
        resizeCanvas();
        setInterval(updateClock, 1000);
        updateClock();

    </script>
</body>
</html>