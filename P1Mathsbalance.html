<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chiikawa Balance Adventure</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background-color: #fff9fb;
            background-image: radial-gradient(#ffe4e9 2px, transparent 2px);
            background-size: 30px 30px;
            touch-action: manipulation;
        }

        /* Animations */
        @keyframes bounce-gentle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-bounce-gentle { animation: bounce-gentle 2s infinite ease-in-out; }

        .seesaw-pivot {
            transition: transform 1s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .card-shadow {
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }
        .card-shadow:active {
            box-shadow: 0 0 0 rgba(0,0,0,0);
            transform: translateY(4px);
        }

        /* Input Styles */
        .num-input {
            caret-color: #ff6b6b;
            outline: none;
            transition: all 0.3s;
        }
        .num-input:focus {
            background-color: #fff0f3;
            border-color: #ffb7c5;
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- SVGs ---
        const ChiikawaFace = () => (
            <svg viewBox="0 0 100 100" className="w-full h-full">
                <circle cx="50" cy="50" r="45" fill="white" stroke="#555" strokeWidth="3"/>
                <circle cx="20" cy="20" r="8" fill="white" stroke="#555" strokeWidth="3"/>
                <circle cx="80" cy="20" r="8" fill="white" stroke="#555" strokeWidth="3"/>
                <circle cx="35" cy="55" r="4" fill="#333"/>
                <circle cx="65" cy="55" r="4" fill="#333"/>
                <path d="M45 65 Q50 70 55 65" stroke="#333" strokeWidth="3" fill="none"/>
                <ellipse cx="30" cy="65" rx="6" ry="4" fill="#ffb7c5" opacity="0.6"/>
                <ellipse cx="70" cy="65" rx="6" ry="4" fill="#ffb7c5" opacity="0.6"/>
            </svg>
        );

        const HachiwareFace = () => (
            <svg viewBox="0 0 100 100" className="w-full h-full">
                <path d="M10,20 L30,5 L50,20 L70,5 L90,20 L90,80 Q90,95 50,95 Q10,95 10,80 Z" fill="white" stroke="#555" strokeWidth="3"/>
                <path d="M10,20 L30,5 L50,20 L70,5 L90,20 L90,40 L10,40 Z" fill="#a2d2ff" stroke="none"/>
                <path d="M10,20 L30,5 L50,20 L70,5 L90,20" fill="none" stroke="#555" strokeWidth="3"/>
                <circle cx="35" cy="55" r="4" fill="#333"/>
                <circle cx="65" cy="55" r="4" fill="#333"/>
                <path d="M45 65 Q50 60 55 65" stroke="#333" strokeWidth="3" fill="none"/>
            </svg>
        );

        const UsagiFace = () => (
            <svg viewBox="0 0 100 100" className="w-full h-full">
                 <ellipse cx="50" cy="60" rx="45" ry="35" fill="#fff3b0" stroke="#555" strokeWidth="3"/>
                 <ellipse cx="30" cy="20" rx="10" ry="25" fill="#fff3b0" stroke="#555" strokeWidth="3" transform="rotate(-10 30 20)"/>
                 <ellipse cx="70" cy="20" rx="10" ry="25" fill="#fff3b0" stroke="#555" strokeWidth="3" transform="rotate(10 70 20)"/>
                 <circle cx="35" cy="55" r="4" fill="#333"/>
                 <circle cx="65" cy="55" r="4" fill="#333"/>
                 <path d="M45 68 Q50 75 55 68" stroke="#333" strokeWidth="3" fill="none"/>
            </svg>
        );

        // --- Main Menu ---
        const MainMenu = ({ onSelectMode }) => {
            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4">
                    <div className="bg-white/90 backdrop-blur-sm p-8 rounded-3xl shadow-xl max-w-md w-full border-4 border-pink-100 text-center">
                        <div className="mb-8">
                            <div className="flex justify-center gap-4 mb-4">
                                <div className="w-16 h-16 animate-bounce-gentle" style={{animationDelay: '0s'}}><ChiikawaFace /></div>
                                <div className="w-16 h-16 animate-bounce-gentle" style={{animationDelay: '0.2s'}}><HachiwareFace /></div>
                                <div className="w-16 h-16 animate-bounce-gentle" style={{animationDelay: '0.4s'}}><UsagiFace /></div>
                            </div>
                            <h1 className="text-3xl font-black text-pink-500 tracking-wider">Âêâ‰ºäÂç°Âìá</h1>
                            <h2 className="text-2xl font-black text-gray-600">Â§©Âπ≥Â§ßÂÜíÈö™</h2>
                        </div>

                        <div className="space-y-4">
                            <button 
                                onClick={() => onSelectMode('anchor')} 
                                className="w-full bg-blue-100 hover:bg-blue-200 text-blue-600 p-4 rounded-2xl border-b-4 border-blue-200 active:border-b-0 active:translate-y-1 transition-all flex items-center gap-4 group"
                            >
                                <div className="text-3xl group-hover:scale-110 transition-transform">‚öñÔ∏è</div>
                                <div className="text-left">
                                    <div className="font-black text-lg">Ê®°Âºè 1ÔºöÂ∞ãÊâæÂúãÁéã</div>
                                    <div className="text-xs text-blue-400 font-bold">È°åÁõÆÔºö_ + 3 = 14 = 8 + _</div>
                                </div>
                            </button>

                            <button 
                                onClick={() => onSelectMode('balance')} 
                                className="w-full bg-pink-100 hover:bg-pink-200 text-pink-600 p-4 rounded-2xl border-b-4 border-pink-200 active:border-b-0 active:translate-y-1 transition-all flex items-center gap-4 group"
                            >
                                <div className="text-3xl group-hover:scale-110 transition-transform">üé™</div>
                                <div className="text-left">
                                    <div className="font-black text-lg">Ê®°Âºè 2ÔºöÂπ≥Ë°°Ê¥æÂ∞ç</div>
                                    <div className="text-xs text-pink-400 font-bold">È°åÁõÆÔºö15 + _ = 17 + _</div>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Game Component ---
        const BalanceGame = ({ mode, onBack }) => {
            const [level, setLevel] = useState(1);
            const [question, setQuestion] = useState(null);
            
            // Inputs for "Anchor" mode (2 inputs) or "Balance" mode (2 inputs)
            const [input1, setInput1] = useState(''); // Left blank
            const [input2, setInput2] = useState(''); // Right blank
            
            const [feedback, setFeedback] = useState('neutral'); // neutral, correct, wrong
            const [tilt, setTilt] = useState(0); // degrees of rotation for seesaw

            // Ref for inputs to focus
            const input1Ref = useRef(null);

            useEffect(() => {
                generateLevel();
            }, [level, mode]);

            // Calculate current sums to animate tilt
            useEffect(() => {
                if (!question) return;

                let leftSum = 0;
                let rightSum = 0;
                const i1 = parseInt(input1) || 0;
                const i2 = parseInt(input2) || 0;

                if (mode === 'anchor') {
                    // Type: A + _ = Target = _ + B
                    // Visual: Left Scale (A + i1) vs Right Scale (Target)
                    // AND THEN: Left Scale (Target) vs Right Scale (i2 + B)
                    // Visualizing 3 parts is hard. Let's visualize ONE balance at a time or a 3-way?
                    // Better: Show the "King" (Target) in the middle fulcrum.
                    // Left side: A + i1. Right side: i2 + B.
                    // If both equal Target, it balances.
                    
                    leftSum = question.numLeft + i1;
                    rightSum = question.numRight + i2;
                    
                    // Tilt logic: 
                    // If Left < Target, tilt Right. If Left > Target, tilt Left.
                    // But we have two independent equations balancing against the center.
                    // Let's simplify: The visual is one big scale.
                    // Left Side: (numLeft + input1). Right Side: (numRight + input2).
                    // BUT they must ALSO equal the Center Target.
                    // Actually, for the visual to work nicely:
                    // Let's make the center target heavy.
                    // Let's calculate net difference from target.
                    
                    const leftDiff = (question.numLeft + i1) - question.target;
                    const rightDiff = (question.numRight + i2) - question.target;
                    
                    // Simple tilt based on total Left vs Total Right for now?
                    // No, the instruction is specific.
                    // Let's rely on checking logic.
                    // Visual: If (L != Target) or (R != Target), it wobbles.
                    
                    // Let's do simple mass comparison for the visual:
                    // Left Mass = question.numLeft + i1
                    // Right Mass = question.numRight + i2
                    // If they are equal, it's flat.
                    // BUT they must both match target.
                    
                    if (leftSum === rightSum) setTilt(0);
                    else if (leftSum > rightSum) setTilt(-10);
                    else setTilt(10);

                } else {
                    // Type: A + _ = B + _
                    leftSum = question.numLeft + i1;
                    rightSum = question.numRight + i2;

                    if (leftSum === rightSum) setTilt(0);
                    else if (leftSum > rightSum) setTilt(-15);
                    else setTilt(15);
                }

            }, [input1, input2, question, mode]);

            const generateLevel = () => {
                setInput1('');
                setInput2('');
                setFeedback('neutral');
                setTilt(0);

                if (mode === 'anchor') {
                    // _ + 3 = 14 = 8 + _
                    // Format: input1 + numLeft = target = numRight + input2
                    // Or: numLeft + input1 ...
                    // Randomize position of blanks? Let's keep it simple first.
                    const target = Math.floor(Math.random() * 11) + 10; // 10 to 20
                    const numLeft = Math.floor(Math.random() * (target - 1)) + 1;
                    const numRight = Math.floor(Math.random() * (target - 1)) + 1;
                    
                    setQuestion({
                        type: 'anchor',
                        target,
                        numLeft,
                        numRight,
                        ans1: target - numLeft,
                        ans2: target - numRight
                    });
                } else {
                    // 15 + _ = 17 + _
                    // numLeft + input1 = numRight + input2
                    // Constraint: input1 and input2 should be positive integers.
                    // Let's pick a 'Total Sum' first.
                    const totalSum = Math.floor(Math.random() * 11) + 15; // 15 to 25
                    const numLeft = Math.floor(Math.random() * (totalSum - 2)) + 1;
                    const numRight = Math.floor(Math.random() * (totalSum - 2)) + 1;
                    
                    // Ensure numLeft != numRight to make it interesting
                    
                    setQuestion({
                        type: 'balance',
                        totalSum, // Hidden target
                        numLeft,
                        numRight,
                        // Answer isn't unique, so we check sum equality in handleCheck
                    });
                }
                
                // Auto focus first input
                setTimeout(() => {
                    if(input1Ref.current) input1Ref.current.focus();
                }, 100);
            };

            const checkAnswer = () => {
                const val1 = parseInt(input1);
                const val2 = parseInt(input2);

                if (isNaN(val1) || isNaN(val2)) return;

                let correct = false;

                if (mode === 'anchor') {
                    const leftSum = val1 + question.numLeft;
                    const rightSum = val2 + question.numRight;
                    if (leftSum === question.target && rightSum === question.target) {
                        correct = true;
                    }
                } else {
                    const leftSum = val1 + question.numLeft;
                    const rightSum = val2 + question.numRight;
                    if (leftSum === rightSum && leftSum > 0) {
                        correct = true;
                    }
                }

                if (correct) {
                    setFeedback('correct');
                    setTilt(0);
                } else {
                    setFeedback('wrong');
                    // Shake effect logic handled by CSS class triggers
                }
            };

            const nextLevel = () => {
                setLevel(level + 1);
            };

            if (!question) return <div>Loading...</div>;

            // --- Visual Renderers ---

            // Defines the visual representation of equations
            const renderEquation = () => {
                if (mode === 'anchor') {
                    // Format: [Input] + num = Target = num + [Input]
                    // Let's align visually with the seesaw
                    // Left Side equation | Middle Target | Right Side equation
                    return (
                        <div className="flex flex-col md:flex-row items-center justify-center gap-2 md:gap-4 text-xl md:text-3xl font-black text-gray-700 bg-white p-4 rounded-xl shadow-sm border-2 border-blue-100">
                            {/* Left Part */}
                            <div className="flex items-center gap-2">
                                <input 
                                    ref={input1Ref}
                                    type="number" 
                                    value={input1} 
                                    onChange={(e) => setInput1(e.target.value)} 
                                    className="num-input w-16 h-16 md:w-20 md:h-20 text-center rounded-xl bg-blue-50 border-2 border-blue-200 text-blue-600 font-bold text-2xl"
                                    placeholder="?"
                                    readOnly={feedback === 'correct'}
                                />
                                <span>+</span>
                                <span className="text-blue-500">{question.numLeft}</span>
                            </div>

                            {/* Center Part */}
                            <div className="flex items-center gap-2 text-gray-400">
                                <span>=</span>
                                <div className="bg-yellow-100 px-4 py-2 rounded-lg border-2 border-yellow-300 text-yellow-600 relative">
                                    {question.target}
                                    <div className="absolute -top-3 -right-3 text-xs bg-yellow-400 text-white px-2 py-0.5 rounded-full">ÂúãÁéã</div>
                                </div>
                                <span>=</span>
                            </div>

                            {/* Right Part */}
                            <div className="flex items-center gap-2">
                                <span className="text-blue-500">{question.numRight}</span>
                                <span>+</span>
                                <input 
                                    type="number" 
                                    value={input2} 
                                    onChange={(e) => setInput2(e.target.value)} 
                                    className="num-input w-16 h-16 md:w-20 md:h-20 text-center rounded-xl bg-blue-50 border-2 border-blue-200 text-blue-600 font-bold text-2xl"
                                    placeholder="?"
                                    readOnly={feedback === 'correct'}
                                />
                            </div>
                        </div>
                    );
                } else {
                    // Format: num + [Input] = num + [Input]
                    return (
                        <div className="flex flex-col md:flex-row items-center justify-center gap-4 text-2xl md:text-3xl font-black text-gray-700 bg-white p-4 rounded-xl shadow-sm border-2 border-pink-100">
                            <div className="flex items-center gap-2">
                                <span className="text-pink-500">{question.numLeft}</span>
                                <span>+</span>
                                <input 
                                    ref={input1Ref}
                                    type="number" 
                                    value={input1} 
                                    onChange={(e) => setInput1(e.target.value)} 
                                    className="num-input w-16 h-16 md:w-20 md:h-20 text-center rounded-xl bg-pink-50 border-2 border-pink-200 text-pink-600 font-bold text-2xl"
                                    placeholder="?"
                                    readOnly={feedback === 'correct'}
                                />
                            </div>

                            <div className="text-gray-400 font-black text-4xl">=</div>

                            <div className="flex items-center gap-2">
                                <span className="text-pink-500">{question.numRight}</span>
                                <span>+</span>
                                <input 
                                    type="number" 
                                    value={input2} 
                                    onChange={(e) => setInput2(e.target.value)} 
                                    className="num-input w-16 h-16 md:w-20 md:h-20 text-center rounded-xl bg-pink-50 border-2 border-pink-200 text-pink-600 font-bold text-2xl"
                                    placeholder="?"
                                    readOnly={feedback === 'correct'}
                                />
                            </div>
                        </div>
                    );
                }
            };

            const leftCurrentTotal = question.numLeft + (parseInt(input1) || 0);
            const rightCurrentTotal = (mode === 'anchor' ? question.numRight + (parseInt(input2) || 0) : question.numRight + (parseInt(input2) || 0));

            return (
                <div className="min-h-screen flex flex-col max-w-3xl mx-auto bg-white shadow-2xl overflow-hidden border-x-4 border-gray-100">
                    {/* Header */}
                    <div className="p-4 flex justify-between items-center bg-gray-50 border-b-2">
                        <button onClick={onBack} className="text-gray-500 font-bold hover:bg-gray-200 px-4 py-2 rounded-full transition-colors">
                            ‚Üê ÈÅ∏ÂñÆ
                        </button>
                        <div className="bg-white px-4 py-1 rounded-full font-bold shadow-sm text-gray-500 border">
                            Á¨¨ {level} È°å
                        </div>
                    </div>

                    {/* Main Game Area */}
                    <div className="flex-1 flex flex-col relative bg-slate-50/50 p-4 md:p-8">
                        
                        {/* 1. Instruction */}
                        <div className="text-center mb-6">
                            {mode === 'anchor' ? (
                                <p className="text-gray-600 font-bold">
                                    ‰∏≠ÈñìÁöÑÂúãÁéãÊòØ <span className="text-yellow-500 text-2xl">{question.target}</span>„ÄÇ<br/>
                                    Ë´ãËÆìÂ∑¶Âè≥ÂÖ©ÈÇäÈÉΩËÆäÊàê <span className="text-yellow-500">{question.target}</span> ÂêßÔºÅ
                                </p>
                            ) : (
                                <p className="text-gray-600 font-bold">
                                    Ë´ãÂ°´ÂÖ•Êï∏Â≠óÔºåËÆìÂ∑¶Âè≥ÂÖ©ÈÇäÁöÑ<span className="text-pink-500 text-xl">Á∏ΩÂíå‰∏ÄÊ®£Â§ß</span>ÔºÅ
                                </p>
                            )}
                        </div>

                        {/* 2. Visual Seesaw */}
                        <div className="relative h-48 md:h-64 mb-8 flex items-end justify-center perspective-1000">
                            
                            {/* The Balance Board */}
                            <div 
                                className="relative w-full max-w-lg h-2 bg-gray-300 rounded-full seesaw-pivot"
                                style={{ transform: `rotate(${tilt}deg)` }}
                            >
                                {/* Left Basket */}
                                <div className="absolute -top-24 left-0 w-24 md:w-32 flex flex-col items-center transition-all">
                                    <div className="w-20 h-20 md:w-24 md:h-24 relative mb-2 animate-bounce-gentle">
                                        <HachiwareFace />
                                        <div className="absolute -bottom-2 w-full text-center bg-white/80 rounded-full text-sm font-bold shadow-sm">
                                            {leftCurrentTotal}
                                        </div>
                                    </div>
                                    <div className="w-24 h-4 bg-blue-400 rounded-full shadow-md"></div>
                                    <div className="w-1 h-8 bg-gray-400 mx-auto"></div>
                                </div>

                                {/* Right Basket */}
                                <div className="absolute -top-24 right-0 w-24 md:w-32 flex flex-col items-center transition-all">
                                    <div className="w-20 h-20 md:w-24 md:h-24 relative mb-2 animate-bounce-gentle" style={{animationDelay: '0.5s'}}>
                                        <UsagiFace />
                                        <div className="absolute -bottom-2 w-full text-center bg-white/80 rounded-full text-sm font-bold shadow-sm">
                                            {mode === 'anchor' ? rightCurrentTotal : (question.numRight + (parseInt(input2) || 0))}
                                        </div>
                                    </div>
                                    <div className="w-24 h-4 bg-pink-400 rounded-full shadow-md"></div>
                                    <div className="w-1 h-8 bg-gray-400 mx-auto"></div>
                                </div>

                                {/* Pivot Point */}
                                <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-12 h-12 z-10">
                                    {mode === 'anchor' ? (
                                        <div className="w-16 h-16 bg-yellow-100 rounded-full border-4 border-yellow-300 flex items-center justify-center font-black text-xl text-yellow-600 shadow-lg absolute -top-8 -left-2">
                                            {question.target}
                                        </div>
                                    ) : (
                                        <div className="w-8 h-8 bg-gray-500 rounded-full border-4 border-white shadow-lg"></div>
                                    )}
                                    {/* Triangle Base */}
                                    <div className="absolute top-6 left-1/2 -translate-x-1/2 w-0 h-0 border-l-[20px] border-l-transparent border-r-[20px] border-r-transparent border-b-[40px] border-b-gray-400"></div>
                                </div>
                            </div>

                        </div>

                        {/* 3. Interactive Inputs */}
                        {renderEquation()}

                    </div>

                    {/* Footer Controls */}
                    <div className="bg-white p-6 border-t flex flex-col items-center gap-4">
                        <div className="h-8 font-bold text-xl">
                            {feedback === 'correct' && <span className="text-green-500 flex items-center gap-2">üéâ Á≠îÂ∞ç‰∫ÜÔºÅÂ•ΩÊ£íÔºÅ</span>}
                            {feedback === 'wrong' && <span className="text-red-500 flex items-center gap-2">ü§î Â•ΩÂÉè‰∏çÂπ≥Ë°°ÂñîÔºåÂÜçÁÆóÁÆóÁúãÔºü</span>}
                        </div>

                        {feedback !== 'correct' ? (
                            <button 
                                onClick={checkAnswer} 
                                className="w-full max-w-sm py-4 rounded-2xl bg-gradient-to-r from-blue-400 to-pink-400 text-white font-black text-xl shadow-lg border-b-4 border-blue-500 active:border-b-0 active:translate-y-1 transition-all"
                            >
                                Ê™¢Êü•Á≠îÊ°à
                            </button>
                        ) : (
                            <button 
                                onClick={nextLevel} 
                                className="w-full max-w-sm py-4 rounded-2xl bg-green-500 text-white font-black text-xl shadow-lg border-b-4 border-green-700 active:border-b-0 active:translate-y-1 transition-all animate-bounce"
                            >
                                ‰∏ã‰∏ÄÈ°å ‚ûú
                            </button>
                        )}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [mode, setMode] = useState(null); // 'anchor' or 'balance'

            if (!mode) return <MainMenu onSelectMode={setMode} />;

            return <BalanceGame mode={mode} onBack={() => setMode(null)} />;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>