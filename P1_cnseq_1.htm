<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è©èªåµæ¢å¤§æŒ‘æˆ°</title>
    <style>
        /* å­—å‹è¨­å®šï¼šå„ªå…ˆä½¿ç”¨åœ“é«” */
        @font-face {
            font-family: 'Rounded';
            src: local('Yuanti SC'), local('YouYuan'), local('Microsoft JhengHei'), local('Hiragino Sans GB'), sans-serif;
        }

        :root {
            --primary-blue: #4facfe;
            --primary-orange: #ff9a44;
            --soft-bg: #e0c3fc;
            --bg-gradient: linear-gradient(120deg, #e0c3fc 0%, #8ec5fc 100%);
            --correct: #00b894;
            --wrong: #ff7675;
            --text-color: #2d3436;
        }

        body {
            font-family: 'Rounded', 'Microsoft JhengHei', sans-serif;
            background-image: var(--bg-gradient);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            user-select: none;
            overflow-x: hidden;
        }

        /* æ¨™é¡Œå€ */
        header {
            background: rgba(255, 255, 255, 0.9);
            width: 90%;
            margin-top: 20px;
            padding: 15px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        h1 {
            color: var(--text-color);
            margin: 0;
            font-size: 1.5rem;
        }

        /* é€²åº¦æ¢ */
        .status-bar {
            display: flex;
            justify-content: space-between;
            width: 90%;
            max-width: 600px;
            margin-top: 10px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            font-size: 1.2rem;
        }

        /* éŠæˆ²ä¸»å¡ç‰‡ */
        #game-card {
            background: white;
            width: 90%;
            max-width: 500px;
            min-height: 400px;
            margin-top: 20px;
            border-radius: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            position: relative;
            transition: all 0.3s;
        }

        /* é¡Œç›®è©èª */
        .word-display {
            font-size: 4rem;
            color: var(--text-color);
            margin: 30px 0;
            font-weight: bold;
            text-shadow: 2px 2px 0 #eee;
        }

        /* æŒ‡ç¤ºæ–‡å­— */
        .instruction {
            font-size: 1.2rem;
            color: #636e72;
            margin-bottom: 20px;
            background: #f1f2f6;
            padding: 8px 20px;
            border-radius: 50px;
        }

        /* æŒ‰éˆ•ç¶²æ ¼ */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 100%;
        }

        .option-btn {
            background: white;
            border: 3px solid var(--primary-blue);
            border-radius: 15px;
            padding: 15px 5px;
            font-size: 1.3rem;
            color: var(--text-color);
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.1s, background 0.2s;
            font-family: inherit;
            box-shadow: 0 4px 0 #a4b0be;
        }

        .option-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 transparent;
        }

        /* ä¸åŒéšæ®µçš„é¡è‰² */
        .phase-1-btn {
            border-color: var(--primary-blue);
            color: var(--primary-blue);
        }
        
        .phase-2-btn {
            border-color: var(--primary-orange);
            color: #d35400;
        }

        .correct {
            background-color: var(--correct) !important;
            color: white !important;
            border-color: #00b894 !important;
            box-shadow: 0 4px 0 #008f72 !important;
        }

        .wrong {
            background-color: var(--wrong) !important;
            color: white !important;
            border-color: #d63031 !important;
            animation: shake 0.4s;
        }

        /* å‹•ç•« */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .animate-pop {
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* æ…¶ç¥ */
        #celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: none;
            z-index: 999;
        }
        
        .confetti {
            position: absolute;
            font-size: 1.5rem;
            animation: fall linear forwards;
        }

        @keyframes fall {
            to { transform: translateY(110vh) rotate(720deg); }
        }

        /* é–‹å§‹æŒ‰éˆ• */
        #start-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            width: 100%;
        }

        .big-btn {
            background: var(--primary-orange);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 2rem;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 0 #e67e22;
            font-family: inherit;
            margin-top: 50px;
        }
        
        .big-btn:active {
            transform: translateY(6px);
            box-shadow: none;
        }

    </style>
</head>
<body>

    <header>
        <h1>è©èªåµæ¢ ğŸ•µï¸â€â™‚ï¸</h1>
    </header>

    <div class="status-bar">
        <span id="score-display">â­ 0</span>
        <span id="streak-display">ğŸ”¥ é€£å‹: 0</span>
    </div>

    <div id="game-card">
        <div id="start-screen">
            <div style="font-size: 5rem; margin-bottom: 20px;">ğŸš€</div>
            <div style="font-size: 1.5rem; text-align: center;">æº–å‚™å¥½æŒ‘æˆ°äº†å—ï¼Ÿ<br>æˆ‘å€‘è¦åˆ†å…©æ­¥èµ°ï¼</div>
            <button class="big-btn" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
        </div>

        <div id="play-area" style="display: none; width: 100%; flex-direction: column; align-items: center;">
            <div class="instruction" id="instruction-text">ç¬¬ä¸€æ­¥ï¼šé€™æ˜¯ä»€éº¼è©ï¼Ÿ</div>
            <div class="word-display animate-pop" id="current-word">---</div>
            
            <div class="options-grid" id="options-container">
                </div>
        </div>
    </div>

    <div id="celebration"></div>

    <script>
        // === è³‡æ–™åº« (Data Source) ===
        // çµæ§‹ï¼šè©èª, ä¸»åˆ†é¡(step1), æ¬¡åˆ†é¡(step2)
        // ä¸»åˆ†é¡ä»£ç¢¼: N=åè©, V=å‹•è©, ADJ=å½¢å®¹è©, T=æ™‚é–“, IDIOM=æˆèª
        
        const database = [
            // 1. åè© (N)
            // A:äººç‰©, B:ç‰©ä»¶, C:åœ°é», D:èº«é«”, E:å‹•æ¤ç‰©, F:é£Ÿç‰©
            {w:"çˆ¸çˆ¸", m:"N", s:"A", l:"äººç‰©"}, {w:"è­¦å¯Ÿ", m:"N", s:"A", l:"äººç‰©"}, {w:"è€å¸«", m:"N", s:"A", l:"äººç‰©"},
            {w:"æ›¸åŒ…", m:"N", s:"B", l:"ç‰©ä»¶"}, {w:"ç©å…·", m:"N", s:"B", l:"ç‰©ä»¶"}, {w:"é‰›ç­†", m:"N", s:"B", l:"ç‰©ä»¶"},
            {w:"å­¸æ ¡", m:"N", s:"C", l:"åœ°é»"}, {w:"å…¬åœ’", m:"N", s:"C", l:"åœ°é»"}, {w:"æ²™ç˜", m:"N", s:"C", l:"åœ°é»"},
            {w:"çœ¼ç›", m:"N", s:"D", l:"èº«é«”"}, {w:"é ­é«®", m:"N", s:"D", l:"èº«é«”"}, {w:"å˜´å·´", m:"N", s:"D", l:"èº«é«”"},
            {w:"å°è²“", m:"N", s:"E", l:"å‹•æ¤ç‰©"}, {w:"å¤§æ¨¹", m:"N", s:"E", l:"å‹•æ¤ç‰©"}, {w:"èŠ±æœµ", m:"N", s:"E", l:"å‹•æ¤ç‰©"},
            {w:"è˜‹æœ", m:"N", s:"F", l:"é£Ÿç‰©"}, {w:"è›‹ç³•", m:"N", s:"F", l:"é£Ÿç‰©"}, {w:"ç‰›å¥¶", m:"N", s:"F", l:"é£Ÿç‰©"},

            // 2. æ™‚é–“ (T)
            // A:æ™‚é–“, B:ç¯€æ—¥
            {w:"æ—©ä¸Š", m:"T", s:"A", l:"æ™‚é–“"}, {w:"æ˜¨å¤©", m:"T", s:"A", l:"æ™‚é–“"}, {w:"é€±æœ«", m:"T", s:"A", l:"æ™‚é–“"},
            {w:"è–èª•ç¯€", m:"T", s:"B", l:"ç¯€æ—¥"}, {w:"æ–°å¹´", m:"T", s:"B", l:"ç¯€æ—¥"}, {w:"ä¸­ç§‹ç¯€", m:"T", s:"B", l:"ç¯€æ—¥"},

            // 3. å‹•è© (V)
            // A:å‹•ä½œ(æ‰‹/è…³), B:ç”Ÿæ´»(æ—¥å¸¸), C:æ„Ÿå—
            {w:"è·‘", m:"V", s:"A", l:"å‹•ä½œ"}, {w:"è·³", m:"V", s:"A", l:"å‹•ä½œ"}, {w:"æ‹æ‰‹", m:"V", s:"A", l:"å‹•ä½œ"},
            {w:"åˆ·ç‰™", m:"V", s:"B", l:"ç”Ÿæ´»"}, {w:"ç¡è¦º", m:"V", s:"B", l:"ç”Ÿæ´»"}, {w:"ä¸Šå­¸", m:"V", s:"B", l:"ç”Ÿæ´»"},
            {w:"å–œæ­¡", m:"V", s:"C", l:"æ„Ÿå—"}, {w:"å®³æ€•", m:"V", s:"C", l:"æ„Ÿå—"}, {w:"è¨å­", m:"V", s:"C", l:"æ„Ÿå—"},

            // 4. å½¢å®¹è© (ADJ)
            // A:å¥½æ€§æ ¼, B:å£æ€§æ ¼, C:å¤–è²Œ, D:é–‹å¿ƒ, E:ä¸é–‹å¿ƒ, F:å‘³é“
            {w:"èª å¯¦", m:"ADJ", s:"A", l:"å¥½æ€§æ ¼"}, {w:"å‹‡æ•¢", m:"ADJ", s:"A", l:"å¥½æ€§æ ¼"},
            {w:"æ‡¶æƒ°", m:"ADJ", s:"B", l:"å£æ€§æ ¼"}, {w:"è‡ªç§", m:"ADJ", s:"B", l:"å£æ€§æ ¼"},
            {w:"é«˜", m:"ADJ", s:"C", l:"å¤–è²Œ"}, {w:"èƒ–", m:"ADJ", s:"C", l:"å¤–è²Œ"}, {w:"åœ“åœ“çš„", m:"ADJ", s:"C", l:"å¤–è²Œ"},
            {w:"èˆˆå¥®", m:"ADJ", s:"D", l:"é–‹å¿ƒ"}, {w:"æ»¿æ„", m:"ADJ", s:"D", l:"é–‹å¿ƒ"},
            {w:"é›£é", m:"ADJ", s:"E", l:"ä¸é–‹å¿ƒ"}, {w:"å¤±æœ›", m:"ADJ", s:"E", l:"ä¸é–‹å¿ƒ"},
            {w:"ç”œ", m:"ADJ", s:"F", l:"å‘³é“"}, {w:"é…¸", m:"ADJ", s:"F", l:"å‘³é“"},

            // 5. æˆèª (IDIOM) - ç›´æ¥ç•¶ä½œä¸€é¡ï¼Œæ²’æœ‰ç¬¬äºŒæ­¥ç´°åˆ†
            {w:"äº”ç¦è‡¨é–€", m:"IDIOM", s:"NONE", l:"æˆèª"}, 
            {w:"èº«é«”å¥åº·", m:"IDIOM", s:"NONE", l:"æˆèª"},
            {w:"é¾é¦¬ç²¾ç¥", m:"IDIOM", s:"NONE", l:"æˆèª"}
        ];

        // æ­¥é©Ÿ 1 çš„é¸é …
        const step1Options = [
            {code: "N", label: "åè© (æ±è¥¿/äºº)"},
            {code: "V", label: "å‹•è© (å‹•ä½œ)"},
            {code: "ADJ", label: "å½¢å®¹è© (æ¨£å­)"},
            {code: "T", label: "æ™‚é–“ / ç¯€æ—¥"},
            {code: "IDIOM", label: "æˆèª (å››å­—è©)"}
        ];

        // æ­¥é©Ÿ 2 çš„é¸é …å°æ‡‰è¡¨ (æ ¹æ“š Step 1 çš„é¸æ“‡å‹•æ…‹é¡¯ç¤º)
        const step2Maps = {
            "N": [
                {code: "A", label: "äººç‰© ğŸ‘¨â€ğŸ‘©â€ğŸ‘§"}, {code: "B", label: "ç‰©ä»¶ ğŸ"},
                {code: "C", label: "åœ°é» ğŸ«"}, {code: "D", label: "èº«é«” ğŸ‘€"},
                {code: "E", label: "å‹•æ¤ç‰© ğŸ±"}, {code: "F", label: "é£Ÿç‰© ğŸ"}
            ],
            "V": [
                {code: "A", label: "å‹•ä½œ (æ‰‹/è…³) ğŸƒ"}, 
                {code: "B", label: "ç”Ÿæ´» (æ—¥å¸¸) ğŸ›Œ"}, 
                {code: "C", label: "æ„Ÿå— (å¿ƒè£¡) â¤ï¸"}
            ],
            "ADJ": [
                {code: "A", label: "å¥½æ€§æ ¼ :) ğŸ˜‡"}, {code: "B", label: "å£æ€§æ ¼ :( ğŸ˜ˆ"},
                {code: "C", label: "å¤–è²Œ ğŸ‘•"}, {code: "D", label: "é–‹å¿ƒ ğŸ˜„"},
                {code: "E", label: "ä¸é–‹å¿ƒ ğŸ˜¢"}, {code: "F", label: "å‘³é“ ğŸ‘…"}
            ],
            "T": [
                {code: "A", label: "æ™‚é–“ â°"}, {code: "B", label: "ç¯€æ—¥ ğŸ‰"}
            ]
        };

        // éŠæˆ²ç‹€æ…‹
        let currentItem = null;
        let score = 0;
        let streak = 0;
        let gamePhase = 1; // 1 = Part of Speech, 2 = Sub-category

        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('play-area').style.display = 'flex';
            nextRound();
        }

        function nextRound() {
            // éš¨æ©Ÿé¸ä¸€å€‹è©
            const rnd = Math.floor(Math.random() * database.length);
            currentItem = database[rnd];

            // é‡ç½®å‹•ç•«
            const wordEl = document.getElementById('current-word');
            wordEl.classList.remove('animate-pop');
            void wordEl.offsetWidth; // trigger reflow
            wordEl.classList.add('animate-pop');
            wordEl.innerText = currentItem.w;

            // é€²å…¥ç¬¬ä¸€éšæ®µ
            setupPhase1();
        }

        function setupPhase1() {
            gamePhase = 1;
            document.getElementById('instruction-text').innerText = "ç¬¬ä¸€æ­¥ï¼šå®ƒæ˜¯ä»€éº¼è©ï¼Ÿ";
            const container = document.getElementById('options-container');
            container.innerHTML = "";
            container.style.gridTemplateColumns = "1fr 1fr"; // 2 columns

            step1Options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn phase-1-btn';
                btn.innerText = opt.label;
                btn.onclick = () => checkAnswer(1, opt.code, btn);
                container.appendChild(btn);
            });
        }

        function setupPhase2() {
            gamePhase = 2;
            
            // å¦‚æœæ˜¯æˆèªï¼Œç›´æ¥è·³éç¬¬äºŒæ­¥ï¼Œå› ç‚ºåªæœ‰ä¸€å€‹é¡åˆ¥
            if (currentItem.m === "IDIOM") {
                celebrateSuccess();
                return;
            }

            document.getElementById('instruction-text').innerText = "ç¬¬äºŒæ­¥ï¼šå®ƒæ˜¯å“ªä¸€é¡ï¼Ÿ";
            const container = document.getElementById('options-container');
            container.innerHTML = "";
            
            // å–å¾—å°æ‡‰çš„å­é¸é …
            const subOptions = step2Maps[currentItem.m];
            
            // å¦‚æœé¸é …è¶…é4å€‹ï¼Œèª¿æ•´gridä½ˆå±€è®“å®ƒå¥½çœ‹é»
            if (subOptions.length > 4) {
                container.style.gridTemplateColumns = "1fr 1fr";
            }

            subOptions.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn phase-2-btn';
                btn.innerText = opt.label;
                btn.onclick = () => checkAnswer(2, opt.code, btn);
                container.appendChild(btn);
            });
        }

        function checkAnswer(phase, code, btn) {
            let isCorrect = false;

            if (phase === 1) {
                if (code === currentItem.m) isCorrect = true;
            } else {
                if (code === currentItem.s) isCorrect = true;
            }

            if (isCorrect) {
                btn.classList.add('correct');
                playSound(true);
                
                if (phase === 1) {
                    // ç¬¬ä¸€æ­¥ç­”å°ï¼Œç¨ç­‰ä¸€ä¸‹é€²å…¥ç¬¬äºŒæ­¥
                    setTimeout(() => {
                        setupPhase2();
                    }, 500);
                } else {
                    // ç¬¬äºŒæ­¥ç­”å°ï¼Œå®Œæˆé€™ä¸€é¡Œ
                    score += 10;
                    streak++;
                    updateScore();
                    celebrateSuccess();
                }

            } else {
                btn.classList.add('wrong');
                playSound(false);
                streak = 0;
                updateScore();
                // éœ‡å‹•
                if (navigator.vibrate) navigator.vibrate(200);
            }
        }

        function celebrateSuccess() {
            showConfetti();
            setTimeout(() => {
                nextRound();
            }, 1200);
        }

        function updateScore() {
            document.getElementById('score-display').innerText = "â­ " + score;
            document.getElementById('streak-display').innerText = "ğŸ”¥ é€£å‹: " + streak;
        }

        // ç°¡å–®éŸ³æ•ˆ
        function playSound(success) {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);

            if (success) {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(500, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1000, ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.2, ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.3);
                osc.start();
                osc.stop(ctx.currentTime + 0.3);
            } else {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, ctx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, ctx.currentTime + 0.2);
                gain.gain.setValueAtTime(0.2, ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.2);
                osc.start();
                osc.stop(ctx.currentTime + 0.2);
            }
        }

        function showConfetti() {
            const container = document.getElementById('celebration');
            container.style.display = 'block';
            container.innerHTML = '';
            
            for(let i=0; i<20; i++) {
                const el = document.createElement('div');
                el.innerText = ['âœ¨', 'ğŸ‰', 'ğŸŒŸ', 'ğŸ­'][Math.floor(Math.random()*4)];
                el.className = 'confetti';
                el.style.left = Math.random() * 100 + '%';
                el.style.animationDuration = (Math.random() * 1.5 + 1) + 's';
                container.appendChild(el);
            }

            setTimeout(() => {
                container.style.display = 'none';
            }, 1500);
        }

    </script>
</body>
</html>